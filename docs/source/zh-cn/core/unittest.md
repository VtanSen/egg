title: 单元测试
---

# 单元测试

## 为什么要单元测试

先问我们自己以下几个问题：

- 你的代码质量如何度量？
- 你是如何保证代码质量？
- 你敢随时重构代码吗？
- 你是如何确保重构的代码依然保持正确性？
- 你是否有足够信心在没有测试的情况下随时发布你的代码？

如果答案都比较犹豫，那么就证明我们非常需要单元测试。

它能带给我们很多好处：
- 代码质量持续有保障
- 重构正确性保障
- 增强自信心
- 自动化运行

web 应用中的单元测试更加重要，在 web 产品快速迭代的时期，每个测试用例的覆盖都是一种可能的承诺。
API 升级，测试用例可以很好地检查代码是否向下兼容。
对于各种可能的输入，一旦测试覆盖，都能明确它的输出。
代码改动后，可以通过测试结果判断代码的改动是否影响已确定的结果。

所以，应用的 controller、service、helper、extend 等代码，都必须有对应的单元测试保证代码质量。
当然，框架和插件的每个功能改动和重构都需要有相应的单元测试，并且要求尽量做到修改代码能被 100% 覆盖到。

## 测试框架

## 断言库

## 测试目录约定

## 准备测试

### app

### ctx

## controller 测试

## service 测试

## helper 测试

## extend 测试

## mock

### 模拟运行环境

### httpclient 异常

### service 异常

## 代码覆盖率

## 示例代码

完整示例代码可以在 [eggjs/exmaples/unittest](https://github.com/eggjs/examples/blob/master/unittest) 找到。
